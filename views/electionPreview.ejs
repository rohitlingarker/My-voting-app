<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="<%= csrfToken %>">
    <title>
        <%=title%>
    </title>
    <link rel="stylesheet" href="./css/index.css">
</head>
<script>
    var token = document
        .querySelector('meta[name="csrf-token"]')
        .getAttribute("content")

    function startElection(id, bool) {
        let allsett=true
        if (!bool) {
            allsett=window.confirm("It appears that some of the questions do not have a minimum (2) options,If you proceed such questions will not be seen in election.Proceed?") 
        }
        if (allsett){
            console.log("running...");
                fetch(`/elections/${id}/start`, {
                    method: "put",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        "_csrf": token
                    })
                })
                    .then((res) => {
                        if (res.ok) {
                            window.location.replace(`/elections/${id}`);
                        }
                    })
                    .catch((err) => console.log(err));
            
        }
    }
</script>

<body>
    <%- include("header.ejs")%>
        <button onclick="startElection(<%=election.id%>,<%=allQuesHaveAtleast2%>)">Start Election</button>

        <h2>
            <%=election.name%>
        </h2>


        <% let questionNo=1 %>
            <% for(let i=0;i<questionsList.length;i++){  %>
                <section>
                    <em>Question<%=questionNo%></em>
                    <b>
                        <%=questionsList[i].name%>
                    </b><br>
                    <p>
                        <%=questionsList[i].description%>
                    </p>

                    <%for(j in optionsList[questionsList[i].id]){%>
                        <ul>

                            <li>
                                <%=optionsList[questionsList[i].id][j].name%>
                            </li>
                        </ul>
                        <%}%>
                </section>

                <% questionNo++; }%>


</body>

</html>